!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Bitpay=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./lib");b.exports=d,d.errors=a("./lib/errors")},{"./lib":5,"./lib/errors":3}],2:[function(a,b,c){"use strict";function d(a){a=a||{},this.verbose=!!a.verbose,this.request=a.request||g,this.baseUrl=a.baseUrl||j;var b=f.parse(this.baseUrl);this.basePath=b.path,this.timeout=a.timeout||5e4,this.verbose?h.setLevel("debug"):h.setLevel("info")}var e=a("./utils/util"),f=a("./utils/url"),g=a("browser-request"),h=a("./log"),i=a("./errors"),j="https://bitpay.com";d.prototype.initialize=function(a,b){return b()},d.prototype.createInvoice=function(a,b){var c="/invoices/";this._doPostRequest(c,a,function(a,c){return a?b(a):b(null,c.data)})},d.prototype.getRates=function(a,b){var c="/rates/";a&&a.currency&&(c+=a.currency),this._doGetRequest(c,function(a,c){return a?b(a):b(null,c.data)},!1)},d.prototype.subscribeToNotifications=function(a,b){var c="/notifications/subscribe/";this._doPostRequest(c,a,function(a,c){return a?b(a):b(null,c)})},d.prototype.unsubscribeFromNotifications=function(a,b){var c="/notifications/unsubscribe/";this._doPostRequest(c,a,function(a,c){return a?b(a):b(null,c)})},d.prototype.getNotifiedInvoices=function(a,b){var c="/notifications/invoices/";this._doPostRequest(c,a,function(a,c){return a?b(a):b(null,c)})},d._parseError=function(a){if("string"==typeof a)try{a=JSON.parse(a)}catch(b){a={error:a}}var c;if(a&&a.code)c=i[a.code]?new i[a.code]:new Error(a.code);else if(a&&a.errors){for(var d="",e=0;e<a.errors.length;e++)switch(a.errors[e].error){case"Missing required parameter.":d+=a.errors[e].error+": "+a.errors[e].param+"\n";break;default:d+=a.errors[e].error+"\n"}c=new Error(d)}else c=new Error(a.error||a);return h.error(c),c},d.prototype._getHeaders=function(a,b,c){var d={};return d},d.prototype._doRequest=function(a,b,c,f){var g=this.baseUrl+b,j={relUrl:this.basePath+b,headers:this._getHeaders(a,b,c),method:a,url:g,body:c,json:!0,timeout:this.timeout};h.debug("Request Args",e.inspect(c,{depth:10})),this.request(j,function(a,b,c){return h.debug(e.inspect(c,{depth:10})),b?200!==b.statusCode?f(404===b.statusCode?new i.NOT_FOUND:b.statusCode?c?d._parseError(c):new i.BAD_REQUEST(b.statusCode):new i.CONNECTION_ERROR):'{"error":"read ECONNRESET"}'===c?f(new i.ECONNRESET_ERROR(JSON.parse(c))):f(null,c,b.header):f(new i.CONNECTION_ERROR)})},d.prototype._doPostRequest=function(a,b,c){return this._doRequest("post",a,b,c)},d.prototype._doPutRequest=function(a,b,c){return this._doRequest("put",a,b,c)},d.prototype._doGetRequest=function(a,b,c){return c&&(a+=a.indexOf("?")>0?"&":"?",a+="r="+Math.floor(9e4*Math.random())+1e4),this._doRequest("get",a,{},b)},d.prototype._doDeleteRequest=function(a,b){return this._doRequest("delete",a,{},b)},b.exports=d},{"./errors":3,"./log":6,"./utils/url":7,"./utils/util":8,"browser-request":9}],3:[function(a,b,c){"use strict";function d(a,b){return a.replace("{0}",b[0]).replace("{1}",b[1]).replace("{2}",b[2])}var e=function(a,b){var c=function(){if("string"==typeof b.message)this.message=d(b.message,arguments);else{if("function"!=typeof b.message)throw new Error("Invalid error definition for "+b.name);this.message=b.message.apply(null,arguments)}this.stack=this.message+"\n"+(new Error).stack};return c.prototype=Object.create(a.prototype),c.prototype.name=a.prototype.name+b.name,a[b.name]=c,b.errors&&f(c,b.errors),c},f=function(a,b){b.forEach(function(b){e(a,b)})},g=function(a,b){return f(a,b),a},h={};h.Error=function(){this.message="Internal error",this.stack=this.message+"\n"+(new Error).stack},h.Error.prototype=Object.create(Error.prototype),h.Error.prototype.name="bpc.Error";var i=a("./spec");g(h.Error,i),b.exports=h.Error,b.exports.extend=function(a){return e(h.Error,a)}},{"./spec":4}],4:[function(a,b,c){"use strict";var d=[{name:"CONNECTION_ERROR",message:"connection error"},{name:"NOT_FOUND",message:"not found"},{name:"ECONNRESET_ERROR",message:"ECONNRESET, body: {0}"},{name:"BAD_REQUEST",message:"bad request, code: {0}"}];b.exports=d},{}],5:[function(a,b,c){b.exports=a("./api")},{"./api":2}],6:[function(a,b,c){var d=function(a){this.name=a||"log",this.level=2};d.prototype.getLevels=function(){return e};var e={debug:0,info:1,log:2,warn:3,error:4,fatal:5};Object.keys(e).forEach(function(a){var b=e[a];d.prototype[a]=function(){if(b>=e[this.level]){if(Error.stackTraceLimit&&"debug"==this.level){var c=Error.stackTraceLimit;Error.stackTraceLimit=2;var d;try{anerror()}catch(f){d=f.stack}var g=d.split("\n"),h=g[2];h=":"+h.substr(6),Error.stackTraceLimit=c}var i,j="["+a+(h||"")+"] "+arguments[0],i=[].slice.call(arguments,1);console[a]?(i.unshift(j),console[a].apply(console,i)):(i.length&&(j+=JSON.stringify(i)),console.log(j))}}}),d.prototype.setLevel=function(a){this.level=a};var f=new d("copay");new Error;f.setLevel("info"),b.exports=f},{}],7:[function(a,b,c){"use strict";b.exports.parse=function(a){var b=a.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return b&&{protocol:b[1],host:b[2],hostname:b[3],port:b[4],path:"/"+b[5],search:b[6],hash:b[7]}}},{}],8:[function(a,b,c){"use strict";b.exports.inspect=function(a,b){}},{}],9:[function(b,c,d){!function(b,e){"function"==typeof a&&a.amd?a([],e):"object"==typeof d?c.exports=e():b.returnExports=e()}(this,function(){function a(e,f){if("function"!=typeof f)throw new Error("Bad callback given: "+f);if(!e)throw new Error("No options given");var h=e.onResponse;if(e="string"==typeof e?{uri:e}:JSON.parse(JSON.stringify(e)),e.onResponse=h,e.verbose&&(a.log=d()),e.url&&(e.uri=e.url,delete e.url),!e.uri&&""!==e.uri)throw new Error("options.uri is a required argument");if("string"!=typeof e.uri)throw new Error("options.uri must be a string");for(var i=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],j=0;j<i.length;j++)if(e[i[j]])throw new Error("options."+i[j]+" is not supported");if(e.callback=f,e.method=e.method||"GET",e.headers=e.headers||{},e.body=e.body||null,e.timeout=e.timeout||a.DEFAULT_TIMEOUT,e.headers.host)throw new Error("Options.headers.host is not supported");e.json&&(e.headers.accept=e.headers.accept||"application/json","GET"!==e.method&&(e.headers["content-type"]="application/json"),"boolean"!=typeof e.json?e.body=JSON.stringify(e.json):"string"!=typeof e.body&&(e.body=JSON.stringify(e.body)));var k=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};if(e.qs){var l="string"==typeof e.qs?e.qs:k(e.qs);-1!==e.uri.indexOf("?")?e.uri=e.uri+"&"+l:e.uri=e.uri+"?"+l}var m=function(a){var b={};b.boundry="-------------------------------"+Math.floor(1e9*Math.random());var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push("--"+b.boundry+'\nContent-Disposition: form-data; name="'+d+'"\n\n'+a[d]+"\n");return c.push("--"+b.boundry+"--"),b.body=c.join(""),b.length=b.body.length,b.type="multipart/form-data; boundary="+b.boundry,b};if(e.form){if("string"==typeof e.form)throw"form name unsupported";if("POST"===e.method){var n=(e.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(e.headers["content-type"]=n,n){case"application/x-www-form-urlencoded":e.body=k(e.form).replace(/%20/g,"+");break;case"multipart/form-data":var o=m(e.form);e.body=o.body,e.headers["content-type"]=o.type;break;default:throw new Error("unsupported encoding:"+n)}}}return e.onResponse=e.onResponse||c,e.onResponse===!0&&(e.onResponse=f,e.callback=c),!e.headers.authorization&&e.auth&&(e.headers.authorization="Basic "+g(e.auth.username+":"+e.auth.password)),b(e)}function b(b){function c(){l=!0;var c=new Error("ETIMEDOUT");return c.code="ETIMEDOUT",c.duration=b.timeout,a.log.error("Timeout",{id:k._id,milliseconds:b.timeout}),b.callback(c,k)}function d(c){if(l)return a.log.debug("Ignoring timed out state change",{state:k.readyState,id:k.id});if(a.log.debug("State change",{state:k.readyState,id:k.id,timed_out:l}),k.readyState===h.OPENED){a.log.debug("Request started",{id:k.id});for(var d in b.headers)k.setRequestHeader(d,b.headers[d])}else k.readyState===h.HEADERS_RECEIVED?e():k.readyState===h.LOADING?(e(),g()):k.readyState===h.DONE&&(e(),g(),i())}function e(){if(!p.response){if(p.response=!0,a.log.debug("Got response",{id:k.id,status:k.status}),clearTimeout(k.timeoutTimer),k.statusCode=k.status,m&&0==k.statusCode){var c=new Error("CORS request rejected: "+b.uri);return c.cors="rejected",p.loading=!0,p.end=!0,b.callback(c,k)}b.onResponse(null,k)}}function g(){p.loading||(p.loading=!0,a.log.debug("Response body loading",{id:k.id}))}function i(){if(!p.end){if(p.end=!0,a.log.debug("Request done",{id:k.id}),k.body=k.responseText,b.json)try{k.body=JSON.parse(k.responseText)}catch(c){return b.callback(c,k)}b.callback(null,k,k.body)}}var k=new h,l=!1,m=f(b.uri),n="withCredentials"in k;if(j+=1,k.seq_id=j,k.id=j+": "+b.method+" "+b.uri,k._id=k.id,m&&!n){var o=new Error("Browser does not support cross-origin request: "+b.uri);return o.cors="unsupported",b.callback(o,k)}k.timeoutTimer=setTimeout(c,b.timeout);var p={response:!1,loading:!1,end:!1};return k.onreadystatechange=d,k.open(b.method,b.uri,!0),m&&(k.withCredentials=!!b.withCredentials),k.send(b.body),k}function c(){}function d(){var a,b,d={},f=["trace","debug","info","warn","error"];for(b=0;b<f.length;b++)a=f[b],d[a]=c,"undefined"!=typeof console&&console&&console[a]&&(d[a]=e(console,a));return d}function e(a,b){function c(c,d){return"object"==typeof d&&(c+=" "+JSON.stringify(d)),a[b].call(a,c)}return c}function f(a){var b,c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{b=location.href}catch(d){b=document.createElement("a"),b.href="",b=b.href}var e=c.exec(b.toLowerCase())||[],f=c.exec(a.toLowerCase()),g=!(!f||f[1]==e[1]&&f[2]==e[2]&&(f[3]||("http:"===f[1]?80:443))==(e[3]||("http:"===e[1]?80:443)));return g}function g(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);switch(m=n.join(""),a.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m}var h=XMLHttpRequest;if(!h)throw new Error("missing XMLHttpRequest");a.log={trace:c,debug:c,info:c,warn:c,error:c};var i=18e4,j=0;a.withCredentials=!1,a.DEFAULT_TIMEOUT=i,a.defaults=function(b,c){var d=function(a){var c=function(c,d){c="string"==typeof c?{uri:c}:JSON.parse(JSON.stringify(c));for(var e in b)void 0===c[e]&&(c[e]=b[e]);return a(c,d)};return c},e=d(a);return e.get=d(a.get),e.post=d(a.post),e.put=d(a.put),e.head=d(a.head),e};var k=["get","put","post","head"];return k.forEach(function(b){var c=b.toUpperCase(),d=b.toLowerCase();a[d]=function(b){"string"==typeof b?b={method:c,uri:b}:(b=JSON.parse(JSON.stringify(b)),b.method=c);var d=[b].concat(Array.prototype.slice.apply(arguments,[1]));return a.apply(this,d)}}),a.couch=function(b,d){function e(a,b,c){if(a)return d(a,b,c);if((b.statusCode<200||b.statusCode>299)&&c.error){a=new Error("CouchDB error: "+(c.error.reason||c.error.error));for(var e in c)a[e]=c[e];return d(a,b,c)}return d(a,b,c)}"string"==typeof b&&(b={uri:b}),b.json=!0,b.body&&(b.json=b.body),delete b.body,d=d||c;var f=a(b,e);return f},a})},{}]},{},[1])(1)});